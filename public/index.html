<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Website Analyzer</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary: #4361ee;
        --error: #ef233c;
        --light: #f8f9fa;
        --dark: #212529;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        background-color: #f5f7fa;
        color: var(--dark);
        padding: 20px;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 30px;
      }

      h1 {
        text-align: center;
        color: var(--primary);
        margin-bottom: 30px;
      }

      .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
      }

      #urlInput {
        flex: 1;
        padding: 12px 15px;
        font-size: 16px;
        border: 2px solid #ddd;
        border-radius: 6px;
        transition: border 0.3s;
      }

      #urlInput:focus {
        outline: none;
        border-color: var(--primary);
      }

      #analyzeButton {
        padding: 12px 25px;
        background-color: var(--primary);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: background 0.3s;
      }

      #analyzeButton:hover {
        background-color: #3a56d4;
      }

      #results {
        margin-top: 30px;
      }

      .card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        padding: 25px;
        margin-bottom: 20px;
      }

      .card h2 {
        color: var(--primary);
        margin-bottom: 15px;
        font-size: 1.4rem;
      }

      .loading-container {
        text-align: center;
        padding: 40px 0;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid rgba(67, 97, 238, 0.2);
        border-top-color: var(--primary);
        border-radius: 50%;
        margin: 0 auto 20px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .error-card {
        background-color: #ffebee;
        border-left: 4px solid var(--error);
        padding: 20px;
        margin-bottom: 20px;
      }

      .error-card i {
        color: var(--error);
        margin-right: 10px;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .info-item {
        background: var(--light);
        padding: 15px;
        border-radius: 6px;
      }

      .info-item h3 {
        font-size: 1rem;
        margin-bottom: 10px;
        color: #555;
      }

      pre {
        background: var(--light);
        padding: 15px;
        border-radius: 6px;
        overflow-x: auto;
        font-family: "Courier New", monospace;
        font-size: 14px;
      }

      @media (max-width: 600px) {
        .search-box {
          flex-direction: column;
        }

        #analyzeButton {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1><i class="fas fa-search"></i> Website Analyzer</h1>

      <div class="search-box">
        <input
          type="text"
          id="urlInput"
          placeholder="Enter website URL (e.g., example.com)"
        />
        <button id="analyzeButton"><i class="fas fa-play"></i> Analyze</button>
      </div>

      <div id="results"></div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const urlInput = document.getElementById("urlInput");
        const analyzeButton = document.getElementById("analyzeButton");
        const resultsDiv = document.getElementById("results");

        // Main analysis function
        const analyzeURL = async () => {
          const url = urlInput.value.trim();

          // Clear previous results
          resultsDiv.innerHTML = "";

          // Validate input
          if (!url) {
            showError("Please enter a website URL");
            return;
          }

          // Show loading state
          showLoading();

          try {
            const response = await fetch("/api/analyze", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ url }),
            });

            if (!response.ok) {
              const errorData = await response.json();
              throw new Error(
                errorData?.error ||
                  errorData?.message ||
                  `Server returned ${response.status}`
              );
            }

            const data = await response.json();
            displayResults(data);
          } catch (error) {
            showError(error.message);
            console.error("Analysis error:", error);
          }
        };

        const showLoading = () => {
          resultsDiv.innerHTML = `
          <div class="loading-container">
            <div class="spinner"></div>
            <p>Analyzing website...</p>
          </div>
        `;
        };

        const showError = (message) => {
          resultsDiv.innerHTML = `
          <div class="error-card">
            <p><i class="fas fa-exclamation-circle"></i> <strong>Error:</strong> ${message}</p>
            <p style="margin-top: 10px;">Try again or check the URL format (e.g., example.com)</p>
          </div>
        `;
        };

        const displayResults = (data) => {
          resultsDiv.innerHTML = `
          <div class="card">
            <h2><i class="fas fa-globe"></i> Analysis Results for ${
              data.domain
            }</h2>
            <p>Analyzed at: ${new Date(data.analyzedAt).toLocaleString()}</p>
            
            <div class="info-grid" style="margin-top: 25px;">
              <div class="info-item">
                <h3><i class="fas fa-info-circle"></i> Domain Info</h3>
                <p><strong>Registrar:</strong> ${
                  data.whoisData.registrar || "Unknown"
                }</p>
                <p><strong>Created:</strong> ${
                  data.whoisData.dates?.created || "Unknown"
                }</p>
                <p><strong>Expires:</strong> ${
                  data.whoisData.dates?.expires || "Unknown"
                }</p>
              </div>
              
              <div class="info-item">
                <h3><i class="fas fa-user"></i> Registrant</h3>
                <p><strong>Name:</strong> ${
                  data.whoisData.registrant?.name || "Unknown"
                }</p>
                <p><strong>Country:</strong> ${
                  data.whoisData.registrant?.country || "Unknown"
                }</p>
              </div>
            </div>
          </div>
          
          <div class="card">
            <h2><i class="fas fa-code"></i> Website Content</h2>
            ${
              data.websiteData.error
                ? `
              <div class="error-card">
                <p><i class="fas fa-exclamation-triangle"></i> ${data.websiteData.error}</p>
              </div>
            `
                : `
              <div class="info-grid">
                <div class="info-item">
                  <h3><i class="fas fa-heading"></i> Title</h3>
                  <p>${data.websiteData.title || "Not found"}</p>
                </div>
                
                <div class="info-item">
                  <h3><i class="fas fa-align-left"></i> Description</h3>
                  <p>${data.websiteData.description || "Not found"}</p>
                </div>
              </div>
            `
            }
          </div>
          
          <div class="card">
            <h2><i class="fas fa-database"></i> Raw Data</h2>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          </div>
        `;
        };

        // Event listeners
        analyzeButton.addEventListener("click", analyzeURL);
        urlInput.addEventListener("keypress", (e) => {
          if (e.key === "Enter") analyzeURL();
        });
      });
    </script>
  </body>
</html>
